matrix:
  allow_failures:
    - os: windows
secure: "eiYBl6QdoX1bBXHXi5Kc6z0Hs3Btvmkh2D9xuoEkh9Um4tbwT/WoWkbIouuYFup5LkHch1TT6QntmMCNM9nJSr2XYLdSvrI7TYEv05BdaTM2rzjJCX/F2QYQlQyL/ehpuBb+IGScZb+X6bU/KAnTFVP5ymkudOBsCGANL8daLZKA9PATlDHf/XBEo/n+GY3hoKRsqhpVIBOQryxdAr4AzMmKy1bJi1o/Sn6IZs+iScUfOgDGjhyCqSk8mXw0r2ybS22BA1sUKbZAAN4U+odkJmXSYaJMux9aJQ3R/vcE6e6gAveVgtB7LjaA8dF/jiXxLYlSBLLvxUbaKBypIh6wPT6ZuXd3w1CZPlc1talndlJhQpgTZfUm9LQrBSRSqR6dsyhhddcyksnVSQYoV+PdEwHvWLAXivtZCQzPxi1XYycHalMm/3qI3zpQCDM56EumU27FkaW0skt9aSx9a8785PNEpmDPp3o7PE4GOqZpN1s0n812HP2u3leAcEGQ4cNNukCrT2sH4faWn1ACJe9ZX6islCSn8QAg5rEBLbDGjEiVltJD0TqzlggPEjpP8dAItRo5cglNVXAKjyrdjCO/5rbG0ehRAGbtEV1gVdOHCrJyJsCTbEkU3C1slaihl8ngyttJH7Sb6yMjmxU8XKkl+vKRfZ8LrNM7AG7/bXA2BGM="
os:
  - osx
  - linux
  - windows

language: rust
rust: stable

env: 
  - $TRAVIS_NODE_VERSION=node
cache:
  - yarn: true
  - cargo: true

before_install:
  # Install Rust and Cargo
  - |
    if [ "$TRAVIS_OS_NAME" == "windows" ]; then
        - export NVS_HOME=$ProgramData/nvs
        - git clone --single-branch https://github.com/jasongin/nvs $NVS_HOME
        - source $NVS_HOME/nvs.sh
        - nvs --version
       - nvs add $TRAVIS_NODE_VERSION && nvs use $TRAVIS_NODE_VERSION 
    else
        curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh | bash
        nvm install $TRAVIS_NODE_VERSION && nvm use $TRAVIS_NODE_VERSION
    fi
   - |
    if [ "$TRAVIS_OS_NAME" == "osx" ]; then
        - brew install yarn
    fi
  # Install global NPM packages
  - node -v
  - npm -v
  - yarn global add yarn@latest
  - yarn

script: 
  - COMMIT_MESSAGE=$(git log --format=%B --no-merges -n 1 | tr -d '\n')
  - if [[ ${COMMIT_MESSAGE} =~ "[publish binary]" ]]; then yarn upload-binary || exit 0; fi;

